<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            position: relative;
            box-sizing: border-box;
            font-family: sans-serif;
            font-size: 16px;
        }

        body {
            display: grid;
            grid-template-areas: "header header header" "left main right" "footer footer footer";
            grid-template-columns: 1fr 3fr 0;
            grid-template-rows: 50px 1fr 50px;
            width: 100%;
            height: 100vh;
        }

        h1 {
            font-size: 28px;
        }

        h2 {
            font-size: 24px;
        }

        h3 {
            font-size: 20px;
        }

        header {
            background: darkcyan;
            grid-area: header;
        }

        #left {
            grid-area: left;
            background: bisque;
        }

        main {
            grid-area: main;
            background: darkgrey;
        }

        #right {
            grid-area: right;
            background: burlywood;
        }

        footer {
            grid-area: footer;
            background: darkkhaki;
        }

        .channels {

        }

        .channels li {
            cursor: pointer;
        }

        .channels li.active {
            font-weight: bold;
            color: red;
        }
    </style>

    <script>
        let token = "51e8a6109f115d9f6c39d4e0d134f0363fec3335cff5081a6d39ac85007c9215";
        let socket = new WebSocket("ws://localhost:8924/socket");
        let currentChannel = null;
        let currentThread = null;
        let currentUser = null;
        let messagesChannel = {};
        let messagesThread = {};

        document.onclick = function (ev) {
            switch (ev.target.dataset.type) {
                case "channel":
                    let id = ev.target.dataset.id
                    let el = document.querySelector(`[data-type='channel'][data-id='${id}']`)

                    currentChannel = id
                    currentThread = null
                    currentUser = null

                    document.querySelectorAll("[data-type='channel']").forEach((v) => {
                        v.classList.remove('active')
                    });

                    el.classList.add('active')
                    loadChannelMessages(id)
                    break;
            }
        }

        function loadChannelMessages(channelId) {
            let main = document.querySelector('main');

            main.innerHTML = `MESSAGES OF CHANNEL ${channelId}`
        }

        socket.onopen = function (ev) {
            console.log("OPEN");

            socket.send(JSON.stringify({
                type: "AUTH",
                token: token,
            }));
        };

        socket.onmessage = function (ev) {
            console.log(ev.data);

            let msg = JSON.parse(ev.data);

            if (msg.type == 'SUCCESS' && msg.target == 'AUTH') {
                socket.send(JSON.stringify({
                    type: "REQUEST",
                    target: "CHANNEL_LIST",
                }));
            }

            if (msg.type == "RESPONSE" && msg.target == "CHANNEL_LIST") {
                let channels = document.querySelector(".channels");
                channels.innerHTML = null

                msg.data.forEach(function (v) {
                    channels.innerHTML += `<li data-type="channel" data-id="${v.id}">${v.title}</li>`;
                });
            }
        };

        socket.onclose = function (ev) {
            if (ev.wasClean) {
                console.log("CLOSED CLEAN");
            } else {
                console.log("CLOSED NOT CLEAN");
            }
        };

        socket.onerror = function (e) {
            console.log("ERROR: " + e.message);
        };
    </script>
</head>
<body>
<header>
    HEADER
</header>

<aside id="left">
    <h3>Channels</h3>
    <ul class="channels"></ul>
</aside>

<main>
    MAIN
</main>

<aside id="right">

</aside>

<footer>
    FOOTER
</footer>
</body>
</html>